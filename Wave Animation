// --- Wave animation state ---
bool waveActive = false;
unsigned long lastWaveUpdate = 0;
int wavePos = 0;
float wavePhase = 0.0;


void startWave() {
  waveActive = true;
  wavePos = 0;
  wavePhase = 0.0;
  lastWaveUpdate = millis();
  saveColors(); // Save base field colors
}


void updateWave() {
  if (!waveActive) return;

  // Update every 40 ms (speed control)
  if (millis() - lastWaveUpdate < 40) return;
  lastWaveUpdate = millis();

  refreshColors(); // Restore base colors

  // Wave brightness (sine fade)
  float brightness = (sin(wavePhase) + 1.0) * 0.5; // 0 â†’ 1
  int blue = (int)(brightness * 255);

  // Move wave horizontally across board
  for (int r = 0; r < 10; r++) {
    int idx = indexConvert(r, wavePos);

    uint32_t oldColor = previousColors[idx];

    uint8_t red   = (oldColor >> 16) & 0xFF;
    uint8_t green = (oldColor >> 8)  & 0xFF;
    uint8_t blue0 = oldColor & 0xFF;

    // Only modify "blue field" pixels
    if (red == 0 && green == 0 && blue0 > 0) {
      strip.setPixelColor(idx, 0, 0, blue);
    }
  }

  strip.show();

  // Advance wave
  wavePhase += 0.4;
  wavePos++;

  // End after one pass
  if (wavePos >= 10) {
    refreshColors();
    strip.show();
    waveActive = false;
  }
}
